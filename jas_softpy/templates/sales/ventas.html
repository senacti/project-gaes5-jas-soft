{% load static %}
<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">    
	<link rel="stylesheet" type="text/css" href="{% static 'css/Style.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/Header.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/footer.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/buttons.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/footer.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/barmenu.css' %}">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/estilos-dash-admin.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.dataTables.min.css' %}">

    <script type="text/javascript" src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
	<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

	<link rel="shortcut icon" href="{% static 'img/iconlogo.png' %}">
	<title>PromoPlast | Ventas</title>
</head>

<body>

	<header class="cabecera">
		<div class="logo-container">
			<img class="logo-dash-admin" src="{% static 'img/logo.png' %}" alt="logo">
		</div>
		<ul class="list-menu-ul">
			<li class="list-menu-dash"> <img class="img-menu-dash" src="{% static 'img/campana.png' %}" alt="Campana"> </li>
			
			<li class="nav-item dropdown">
				<a id="navbarDropdown" class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false" v-pre>
                    <span>{{ user.username }}</span>
                </a>
				<div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown" id="cerrar">
					<a class="dropdown-item" href="#" onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
						Cerrar sesión
					</a>
					<form id="logout-form" action="{% url 'logout' %}" method="post" class="d-none">
						{% csrf_token %}
					</form>
				</div>	
			</li>
		</ul>
	</header>
	
	<div class="container-fluid">
		<div class="row">
			
			{% include 'menumodulos.html' %}
			

	<!-- The Modal -->
	<div class="modal" id="myModal">
		<div class="modal-dialog">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">Crear venta</h4>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<!-- Modal body -->
				<div class="modal-body">
					<form action="@{/ventum/guardar}" class="was-validated" object="${ventum}" method="POST">
						<div class="row">
							<div class="col-md-6">
								<div class="form-floating mt-3 mb-3">
									<input type="date" required class="form-control" id="fecha"
										placeholder="fecha Venta" field="*{fecha}" maxlength="20">
									<label for="fechaVenta">Fecha</label>
								</div>

								<div class="form-floating mb-3">
									<input type="text" class="form-control" id="totalventa" placeholder="Total"
										field="*{totalventa}" name="totalventa" required>
									<label for="totalVenta">Total</label>
								</div>

								<div class="form-floating mb-3">
									<input type="text" class="form-control" id="subtotal" field="*{subtotal}"
										placeholder="subtotal" name="subtotal" required>
									<label for="subtotal">Subtotal</label>
								</div>

								<div class="form-floating mb-3">
									<input type="text" class="form-control" id="descuento"
										field="*{cantidaddescuento}" placeholder="Descuento" name="descuento"
										required>
									<label for="descuento">Descuento</label>
								</div>
							</div>

							<div class="col-md-6">
								<div class="form-floating mb-3">
									<input type="text" class="form-control" field="*{totaliva}" id="totalIva"
										placeholder="IVA" name="totalIva" required>
									<label for="totalIva">IVA</label>
									<div class="valid-feedback"></div>
								</div>

								<div class="form-floating mt-3 mb-3">
									<select class="form-select" id="idcliente" placeholder="Estado"
										field="*{idcliente}" name="idcliente">
										<option value="0">Seleccione</option>
										<option value="Cliente Frecuente">Cliente Frecuente</option>
										<option value="Cliente Potencial">Cliente Potencial</option>
										<option value="Cliente Nuevo">Cliente Nuevo</option>
										<option value="Cliente Inactivo">Cliente Inactivo</option>
										<option value="Cliente VIP">Cliente VIP</option>
									</select>
									<label for="idcliente" class="form-label">Cliente</label>
								</div>

								<div class="form-floating mt-3 mb-3">
									<select class="form-select" id="idpagos" placeholder="Estado" field="*{idpagos}"
										name="idpagos">
										<option value="0">Seleccione</option>
										<option value="Parcial">Parcial</option>
										<option value="Total">Total</option>
									</select>
									<label for="idpagos" class="form-label">Pagos</label>
								</div>

								<div class="form-floating mt-3 mb-3">
									<select class="form-select" id="idempleado" field="*{idempleado}"
										placeholder="Empleado" name="idempleado">
										<option value="0">Seleccione</option>
										<option value="Pedro">Pedro</option>
										<option value="Santiago">Santiago</option>
										<option value="Valentina">Valentina</option>
										<option value="Osman">Osman</option>
										<option value="Fulanito">Fulanito</option>
										<option value="Oscar">Oscar</option>
										<option value="David">David</option>
									</select>
									<label for="idempleado" class="form-label">Empleado</label>
								</div>
								
								<input type="hidden" class="form-control" field="*{idordenpedido}" value="10"
									placeholder="idordenpedido" name="idordenpedido" required>

							</div>
						</div>

				</div>

				<!-- Modal footer -->
				<div class="modal-footer">
					<button type="button" class="btn btn-danger btn-sm" data-bs-dismiss="modal">Cerrar</button>
					<button type="submit" class="btn btn-primary btn-sm">Guardar</button>
				</div>
				</form>
			</div>
		</div>
	</div>

	

			<div class="col-10" id="contentd">
				<div class="card" id="cardash">
					<div class="container mt-3">
						<h2>VENTAS</h2>
                        <!--
						<div if=${param.exito}>
							<div class="alert alert-info" style="color: forestgreen;">Proceso Exitoso
							</div>
						</div>
						<div if=${param.error}>
							<div class="alert alert-danger" style="color: red;">Hubo un problema en el proceso </div>
						</div>
						<div if=${param.exitoeliminar}>
							<div class="alert alert-info" style="color: forestgreen;">eliminado Correctamente</div>
						</div>
						<div if=${param.erroreliminar}>
							<div class="alert alert-danger" style="color: red;">Hubo un problema al eliminar </div>
						</div>
						<p></p>
						<div class="tarjetas">
							<div class="row">
								<div class="col">
									<img src="@{/img/grafico1.png}" alt="grafico1" id="grafico">
								</div>
								<div class="col">
									<img src="@{/img/grafico2.png}" alt="grafico2" id="grafico">
								</div>
							</div>
						</div>
                        -->
						<table class="table table-striped" id="tablas">
							<thead class="thead">
								<tr>
									<th>Idventa</th>
									<th>Fecha</th>
									<th>Total</th>
									<th>Subtotal</th>
									<th>Descuento</th>
									<th>IVA</th>
									<th>Cliente</th>
									<th>Pagos</th>
									<th>Empleado</th>
									<th>Ordenpedido</th>
									<td>Editar</td>
									<td>Eliminar</td>
								</tr>
							</thead>
							<tbody>
								<tr each="in:${ventums}">
									<td text="${in.idventa}"></td>
									<td text="${in.fecha}"></td>
									<td text="${in.totalventa}"></td>
									<td text="${in.subtotal}"></td>
									<td text="${in.cantidaddescuento}"></td>
									<td text="${in.totaliva}"></td>
									<td text="${in.idcliente}"></td>
									<td text="${in.idpagos}"></td>
									<td text="${in.idempleado}"></td>
									<td text="${in.idordenpedido}"></td>
									<td>
										<a href="@{/ventum/editar/} + ${in.idventa}">
											<button type="button" class="btn btn-success">
												Editar
											</button>
										</a>

									</td>
									<td>
										<a href="@{/ventum/eliminar/} + ${in.idventa}">
											<button type="button" class="btn btn-danger">
												Eliminar
											</button>
										</a>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="button-new">
							{% if user_permissions %}
								{% for permiso in user_permissions %} 
									{% if permiso == 'add_sales' %}
										<button type="button" class="" data-bs-toggle="modal" data-bs-target="#myModal">
											Nueva Venta
										</button>
									{% endif %}
								{% endfor %}
							{% endif %}
							<a class="button-excel" href="@{/ventum/exportar/excel}">
								Exportar a Excel
							</a>
						
	</div>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script type="text/javascript" src="{% static 'js/jquery.dataTables.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dataTables.bootstrap.min.js' %}"></script>
	<script>
        $(document).ready(function () {
            var oTable = $("#tablas").dataTable({
                dom: 'Bfrtip',

                language: {
                    sProcessing: "Procesando...",
                    sLengthMenu: "Mostrar MENU",
                    sZeroRecords: "No se encontraron resultados",
                    sEmptyTable: "Ningún dato disponible en esta tabla",
                    sInfo: "Mostrando del inicio al fin de un total registros",
                    sInfoEmpty: "Mostrando del 0 al 0 de un total de 0 registros",
                    sInfoFiltered: "(filtrado de un total de MAX registros)",
                    sInfoPostFix: "",
                    sSearch: "Buscar:",
                    sUrl: "",
                    sInfoThousands: ",",
                    sLoadingRecords: "Cargando...",
                    oPaginate: {
                        sFirst: "Primero",
                        sLast: "Último",
                        sNext: "Siguiente",
                        sPrevious: "Anterior"
                    },
                    oAria: {
                        sSortAscending: ": Activar para ordenar la columna de manera ascendente",
                        sSortDescending: ": Activar para ordenar la columna de manera descendente"
                    },
                },
            });

        });

        function mostrarid() {
            id = document.getElementById('idventa').value;
            alert(id);
        }

        function abrirmodal() {
            $('#editar').show();
        }
    </script>

	
</body>

</html>